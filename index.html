<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MIS 221 Scavenger Hunt Portal</title>
  <style>
    :root {
      --ink: #0f172a;
      --crimson: #9e1b32;
      --crimson-dark: #6a0f1d;
      --sand: #f6f2ea;
      --card: #ffffff;
      --shadow: 0 16px 40px rgba(15, 23, 42, 0.16);
      --radius: 16px;
      --slate: #4b5563;
      --mint: #0fbf93;
      --amber: #f4a261;
      --indigo: #4338ca;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at 15% 20%, #ffe8e6 0%, rgba(255,255,255,0) 25%),
                  radial-gradient(circle at 85% 10%, #dbeafe 0%, rgba(255,255,255,0) 30%),
                  linear-gradient(135deg, #f8fafc 0%, #f0f4ff 45%, #fce7f3 100%);
      color: var(--ink);
      padding: 28px 16px 60px;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    header {
      background: linear-gradient(135deg, var(--crimson) 0%, var(--crimson-dark) 60%, #111827 100%);
      color: #fff;
      border-radius: var(--radius);
      padding: 22px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      isolation: isolate;
    }

    header::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.28), rgba(255,255,255,0)),
                  linear-gradient(120deg, rgba(255,255,255,0.12), rgba(255,255,255,0));
      pointer-events: none;
    }

    h1 {
      font-size: clamp(1.8rem, 3vw, 2.4rem);
      margin-top: 6px;
      letter-spacing: -0.01em;
    }

    .eyebrow {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-weight: 800;
      font-size: 0.85rem;
      color: rgba(255,255,255,0.8);
    }

    .pill-row { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .pill { background: rgba(255,255,255,0.14); padding: 10px 12px; border-radius: 999px; font-weight: 700; }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,0.04);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .split {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 14px;
    }

    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 12px; }

    label { font-weight: 700; font-size: 0.95rem; color: var(--ink); }
    input, select, textarea {
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      background: #fff;
      font-size: 0.95rem;
      transition: border 0.2s, box-shadow 0.2s;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--crimson);
      box-shadow: 0 0 0 3px rgba(158, 27, 50, 0.18);
    }

    button {
      border: none;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 800;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.2s ease, background 0.2s;
      display: inline-flex;
      gap: 8px;
      align-items: center;
      font-size: 0.9rem;
    }
    button:hover { transform: translateY(-1px); }
    button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .primary { background: var(--crimson); color: #fff; box-shadow: 0 10px 20px rgba(158, 27, 50, 0.25); }
    .ghost { background: #eef2ff; color: #312e81; }
    .outline { background: #fff; border: 1px solid #e2e8f0; }
    .danger { background: #fee2e2; color: #7f1d1d; }
    .success { background: #d1fae5; color: #065f46; }

    .badge { padding: 6px 10px; background: #ecfeff; color: #0f766e; border-radius: 10px; font-weight: 700; font-size: 0.85rem; }
    .muted { color: var(--slate); line-height: 1.5; font-size: 0.95rem; }

    .status-pill { padding: 6px 10px; border-radius: 10px; font-weight: 700; font-size: 0.85rem; width: fit-content; }
    .todo { background: #fff7ed; color: #9a3412; }
    .pending { background: #fef3c7; color: #92400e; }
    .approved { background: #d1fae5; color: #065f46; }
    .rejected { background: #fee2e2; color: #7f1d1d; }

    .list { display: grid; gap: 10px; }
    .list-item { background: #f8fafc; border: 1px solid #e2e8f0; padding: 12px; border-radius: 12px; display: flex; justify-content: space-between; gap: 10px; align-items: center; flex-wrap: wrap; }

    .role-toggle { display: inline-flex; gap: 8px; background: #f8fafc; padding: 6px; border-radius: 14px; }
    .role-toggle button { border-radius: 10px; padding: 8px 12px; }
    .role-toggle button[aria-pressed="true"] { background: #eef2ff; color: #312e81; box-shadow: 0 8px 18px rgba(49, 46, 129, 0.14); }

    .inline { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }

    .hidden { display: none !important; }

    .login-shell {
      max-width: 520px;
      margin: 0 auto;
    }

    .full-screen-center {
      min-height: 60vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal {
      background: white;
      border-radius: var(--radius);
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-body {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .modal-footer {
      padding: 20px;
      border-top: 1px solid #e2e8f0;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .team-card {
      background: #f8fafc;
      border: 2px solid #e2e8f0;
      padding: 16px;
      border-radius: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s;
      cursor: pointer;
    }

    .team-card:hover {
      border-color: var(--crimson);
      box-shadow: 0 4px 12px rgba(158, 27, 50, 0.15);
    }

    .rejection-reason {
      background: #fee2e2;
      border: 1px solid #fca5a5;
      padding: 12px;
      border-radius: 10px;
      margin-top: 8px;
      color: #7f1d1d;
    }

    .faculty-card {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 14px;
      align-items: center;
      padding: 14px;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      background: #f8fafc;
    }

    .avatar {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--crimson), #dc143c);
      display: grid;
      place-items: center;
      font-weight: 800;
      color: #fff;
      font-size: 1.3rem;
    }

    .leaderboard-item {
      padding: 14px;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .rank-badge {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      display: grid;
      place-items: center;
      font-weight: 800;
      color: #fff;
      font-size: 1.1rem;
    }

    .rank-badge.first {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
    }

    .rank-badge.second {
      background: linear-gradient(135deg, #94a3b8, #64748b);
    }

    .rank-badge.third {
      background: linear-gradient(135deg, #d97706, #92400e);
    }

    .progress-bar {
      height: 10px;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
      flex: 1;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--crimson), #dc143c);
      border-radius: 999px;
      transition: width 0.3s ease;
    }

    @media (max-width: 640px) {
      body { padding: 18px 12px 48px; }
      header, .card { padding: 16px; }
      .modal { max-height: 95vh; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="eyebrow">MIS 221 / University of Alabama</div>
      <h1>MIS Scavenger Hunt Portal</h1>
    </header>

    <!-- Login Section -->
    <section id="loginSection" class="full-screen-center">
      <div class="card login-shell">
        <div class="inline" style="justify-content: space-between;">
          <div>
            <p class="eyebrow" style="color: var(--crimson);">Portal access</p>
            <h2 style="margin-top:4px;">Login to continue</h2>
            <p class="muted">Enter your Alabama email or use demo mode.</p>
          </div>
          <div class="badge">Locked</div>
        </div>

        <label for="email">School email</label>
        <input id="email" type="email" placeholder="crimson@ua.edu" autocomplete="username">

        <div class="inline" style="justify-content: space-between; align-items: center; flex-wrap: wrap;">
          <button class="primary" id="loginBtn">Login</button>
          <div class="inline" style="gap:6px;">
            <button class="ghost" data-demo="student">Student Demo</button>
            <button class="ghost" data-demo="ta">TA Demo</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Portal -->
    <section id="portal" class="hidden">
      <div class="card" style="flex-direction: row; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
        <div>
          <p class="eyebrow" style="color: var(--slate);">Role navigation</p>
          <h2 id="activeRoleTitle">Student workspace</h2>
        </div>
        <div class="role-toggle" role="group" aria-label="Toggle persona">
          <button id="studentTab" aria-pressed="true">Student</button>
          <button id="taTab" aria-pressed="false">TA</button>
        </div>
      </div>

      <!-- STUDENT VIEW -->
      <section id="studentArea">
        <!-- Team Management -->
        <div class="card">
          <div class="inline" style="justify-content: space-between;">
            <div>
              <p class="eyebrow" style="color: var(--slate);">Team management</p>
              <h2>Your team</h2>
            </div>
            <span class="badge" id="studentTeamBadge">No team</span>
          </div>
          
          <div id="noTeamSection">
            <p class="muted">You're not on a team yet. Create one or join an existing team below.</p>
            
            <div class="grid">
              <div>
                <label for="newTeamName">Create new team</label>
                <input id="newTeamName" type="text" placeholder="Crimson Coders">
              </div>
            </div>
            <button class="primary" id="createTeamBtn">Create team</button>

            <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 10px 0;">

            <div>
              <h3 style="margin-bottom: 10px;">Available teams</h3>
              <div id="availableTeamsList" class="list"></div>
            </div>
          </div>

          <div id="hasTeamSection" class="hidden">
            <div style="background: #f8fafc; padding: 16px; border-radius: 12px; border: 1px solid #e2e8f0;">
              <h3 id="currentTeamName" style="color: var(--crimson); margin-bottom: 4px;"></h3>
              <p class="muted" id="currentTeamMembers"></p>
            </div>
            <button class="danger" id="leaveTeamBtn">Leave team</button>
          </div>
        </div>

        <!-- Leaderboard -->
        <div class="card">
          <div class="inline" style="justify-content: space-between;">
            <div>
              <p class="eyebrow" style="color: var(--slate);">Competition</p>
              <h2>Team leaderboard</h2>
            </div>
            <span class="badge">Live rankings</span>
          </div>
          <div id="studentLeaderboard" class="list"></div>
        </div>

        <!-- Faculty & Staff Bios -->
        <div class="card">
          <div class="inline" style="justify-content: space-between;">
            <div>
              <p class="eyebrow" style="color: var(--slate);">Directory</p>
              <h2>Faculty & staff</h2>
            </div>
            <span class="badge" id="facultyCount">0</span>
          </div>
          <p class="muted">Get to know the people you'll meet during scavenger hunt assignments.</p>
          <div id="studentFacultyList" class="list"></div>
        </div>

        <!-- Assignments - Three Categories -->
        <div class="split">
          <!-- To-Do (Unattempted) -->
          <div class="card">
            <div class="inline" style="justify-content: space-between;">
              <div>
                <p class="eyebrow" style="color: var(--slate);">To-do</p>
                <h2>Unattempted</h2>
              </div>
              <span class="badge" id="todoCount">0</span>
            </div>
            <div id="todoList" class="list"></div>
          </div>

          <!-- Pending (Awaiting TA Review) -->
          <div class="card">
            <div class="inline" style="justify-content: space-between;">
              <div>
                <p class="eyebrow" style="color: var(--slate);">Pending</p>
                <h2>Awaiting review</h2>
              </div>
              <span class="badge" id="pendingCount">0</span>
            </div>
            <div id="pendingList" class="list"></div>
          </div>

          <!-- Complete (Approved) -->
          <div class="card">
            <div class="inline" style="justify-content: space-between;">
              <div>
                <p class="eyebrow" style="color: var(--slate);">Complete</p>
                <h2>Approved</h2>
              </div>
              <span class="badge" id="completeCount">0</span>
            </div>
            <div id="completeList" class="list"></div>
          </div>
        </div>
      </section>

      <!-- TA VIEW -->
      <section id="taArea" class="hidden">
        <div class="split">
          <!-- Team Management -->
          <div class="card">
            <div class="inline" style="justify-content: space-between;">
              <div>
                <p class="eyebrow" style="color: var(--slate);">TA admin</p>
                <h2>Manage teams</h2>
              </div>
              <span class="badge" id="teamTotal">0</span>
            </div>
            <p class="muted">View and edit existing teams. Students create teams from their portal.</p>
            <div class="list" id="taTeamList"></div>
          </div>

          <!-- Leaderboard (TA View) -->
          <div class="card">
            <div class="inline" style="justify-content: space-between;">
              <div>
                <p class="eyebrow" style="color: var(--slate);">Competition</p>
                <h2>Team leaderboard</h2>
              </div>
              <span class="badge">Live rankings</span>
            </div>
            <div id="taLeaderboard" class="list"></div>
          </div>
        </div>

        <div class="split">
          <!-- Assignment Management -->
          <div class="card">
            <div class="inline" style="justify-content: space-between;">
              <div>
                <p class="eyebrow" style="color: var(--slate);">Assignments</p>
                <h2>Create & edit tasks</h2>
              </div>
              <span class="badge" id="assignmentCount">0</span>
            </div>
            <button class="primary" id="createAssignmentBtn">+ Create new assignment</button>
            <div class="list" id="taAssignmentList"></div>
          </div>

          <!-- Faculty Management -->
          <div class="card">
            <div class="inline" style="justify-content: space-between;">
              <div>
                <p class="eyebrow" style="color: var(--slate);">Directory</p>
                <h2>Faculty & staff bios</h2>
              </div>
              <span class="badge" id="taFacultyCount">0</span>
            </div>
            <button class="primary" id="createFacultyBtn">+ Add faculty/staff</button>
            <div class="list" id="taFacultyList"></div>
          </div>
        </div>

        <!-- Review Queue -->
        <div class="card">
          <div class="inline" style="justify-content: space-between;">
            <div>
              <p class="eyebrow" style="color: var(--slate);">Grading</p>
              <h2>Review queue</h2>
            </div>
            <span class="badge" id="reviewTotal">0</span>
          </div>
          <div id="reviewList" class="list"></div>
        </div>
      </section>
    </section>
  </div>

  <!-- Assignment Detail Modal -->
  <div id="assignmentModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modalTitle">Assignment Details</h2>
        <button class="ghost" onclick="closeAssignmentModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div>
          <strong>Description:</strong>
          <p id="modalDescription" class="muted" style="margin-top: 6px;"></p>
        </div>
        <div>
          <strong>Points:</strong>
          <span id="modalPoints" style="margin-left: 6px;"></span>
        </div>
        <div>
          <strong>Due date:</strong>
          <span id="modalDue" style="margin-left: 6px;"></span>
        </div>
        <div>
          <strong>Location/Contact:</strong>
          <p id="modalLocation" class="muted" style="margin-top: 6px;"></p>
        </div>

        <div id="rejectionSection" class="hidden">
          <div class="rejection-reason">
            <strong>‚ö†Ô∏è Previous submission rejected</strong>
            <p id="rejectionReason" style="margin-top: 8px;"></p>
          </div>
        </div>

        <hr style="border: none; border-top: 1px solid #e2e8f0;">

        <div>
          <label for="uploadFile">Upload file (photo/document)</label>
          <input id="uploadFile" type="file" accept="image/*,.pdf,.doc,.docx">
        </div>

        <div>
          <label for="submissionComments">Comments (optional)</label>
          <textarea id="submissionComments" rows="4" placeholder="Add any notes about your submission..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="outline" onclick="closeAssignmentModal()">Cancel</button>
        <button class="primary" id="submitAssignmentBtn">Submit</button>
      </div>
    </div>
  </div>

  <!-- Rejection Detail Modal -->
  <div id="rejectionModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2>Rejection Details</h2>
        <button class="ghost" onclick="closeRejectionModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="rejection-reason">
          <strong>Reason for rejection:</strong>
          <p id="rejectionModalReason" style="margin-top: 8px;"></p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="primary" onclick="closeRejectionModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- Team Detail Modal (TA) -->
  <div id="teamDetailModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2>Team Details</h2>
        <button class="ghost" onclick="closeTeamDetailModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div>
          <label for="editTeamName">Team name</label>
          <input id="editTeamName" type="text" placeholder="Team name">
        </div>
        
        <div>
          <strong>Team members:</strong>
          <div id="teamMembersList" style="margin-top: 10px;">
            <!-- Members will be dynamically inserted -->
          </div>
        </div>

        <div>
          <strong>Team score:</strong>
          <span id="teamScore" style="margin-left: 6px;"></span>
        </div>
      </div>
      <div class="modal-footer">
        <button class="danger" id="deleteTeamBtn">Delete team</button>
        <button class="outline" onclick="closeTeamDetailModal()">Cancel</button>
        <button class="primary" id="saveTeamBtn">Save changes</button>
      </div>
    </div>
  </div>

  <!-- Faculty Bio Modal -->
  <div id="facultyModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2 id="facultyModalTitle">Faculty/Staff Bio</h2>
        <button class="ghost" onclick="closeFacultyModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div>
          <label for="facultyName">Name</label>
          <input id="facultyName" type="text" placeholder="Dr. Jane Smith">
        </div>
        <div>
          <label for="facultyRole">Role/Title</label>
          <input id="facultyRole" type="text" placeholder="Associate Professor">
        </div>
        <div>
          <label for="facultyLocation">Office location</label>
          <input id="facultyLocation" type="text" placeholder="Culverhouse 225">
        </div>
        <div>
          <label for="facultyBio">Bio</label>
          <textarea id="facultyBio" rows="4" placeholder="Brief biography, research interests, or relevant background..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="danger" id="deleteFacultyBtn" class="hidden">Delete</button>
        <button class="outline" onclick="closeFacultyModal()">Cancel</button>
        <button class="primary" id="saveFacultyBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- Assignment Edit Modal -->
  <div id="assignmentEditModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2 id="assignmentEditModalTitle">Create Assignment</h2>
        <button class="ghost" onclick="closeAssignmentEditModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div>
          <label for="assignmentTitle">Title</label>
          <input id="assignmentTitle" type="text" placeholder="Take a selfie at Bryant-Denny">
        </div>
        <div>
          <label for="assignmentDescription">Description</label>
          <textarea id="assignmentDescription" rows="4" placeholder="Detailed instructions for students..."></textarea>
        </div>
        <div class="grid">
          <div>
            <label for="assignmentPoints">Points</label>
            <input id="assignmentPoints" type="number" placeholder="25">
          </div>
          <div>
            <label for="assignmentDue">Due date</label>
            <input id="assignmentDue" type="date">
          </div>
        </div>
        <div>
          <label for="assignmentLocation">Location/Contact info</label>
          <input id="assignmentLocation" type="text" placeholder="Bryant-Denny Stadium, gate 12">
        </div>
      </div>
      <div class="modal-footer">
        <button class="danger" id="deleteAssignmentBtn" class="hidden">Delete</button>
        <button class="outline" onclick="closeAssignmentEditModal()">Cancel</button>
        <button class="primary" id="saveAssignmentBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- Review Modal (TA) -->
  <div id="reviewModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2>Review Submission</h2>
        <button class="ghost" onclick="closeReviewModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div>
          <strong>Team:</strong>
          <span id="reviewTeamName" style="margin-left: 6px;"></span>
        </div>
        <div>
          <strong>Assignment:</strong>
          <p id="reviewAssignmentTitle" style="margin-top: 6px;"></p>
        </div>
        <div>
          <strong>Comments:</strong>
          <p id="reviewComments" class="muted" style="margin-top: 6px;"></p>
        </div>
        <div>
          <strong>File submitted:</strong>
          <p id="reviewFile" class="muted" style="margin-top: 6px;"></p>
        </div>

        <hr style="border: none; border-top: 1px solid #e2e8f0;">

        <div id="rejectReasonSection" class="hidden">
          <label for="rejectReasonInput">Rejection reason</label>
          <textarea id="rejectReasonInput" rows="3" placeholder="Explain why this submission doesn't meet requirements..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="outline" onclick="closeReviewModal()">Cancel</button>
        <button class="danger" id="rejectSubmissionBtn">Reject</button>
        <button class="success" id="approveSubmissionBtn">Approve</button>
      </div>
    </div>
  </div>

  <script>
    // University of Alabama MIS Program Assignments
    const ASSIGNMENTS = [
      {
        id: 'A1',
        title: 'Selfie at Culverhouse College of Business',
        description: 'Take a team photo in front of the Culverhouse College of Business building. Show your Bama spirit!',
        points: 10,
        due: '2024-12-10',
        location: 'Culverhouse College, 361 Stadium Dr'
      },
      {
        id: 'A2',
        title: 'Meet with MIS Career Advisor',
        description: 'Schedule and complete a meeting with an MIS career advisor. Get advice on internships or career paths. Submit a photo with the advisor or screenshot of meeting confirmation.',
        points: 25,
        due: '2024-12-12',
        location: 'Alston Hall, MIS Advising Office'
      },
      {
        id: 'A3',
        title: 'Find Dr. Randy Bradley',
        description: 'Locate Dr. Randy Bradley (Department Chair) and take a photo with him. Ask him about his research in supply chain analytics!',
        points: 20,
        due: '2024-12-11',
        location: 'Office in Alston Hall or Culverhouse'
      },
      {
        id: 'A4',
        title: 'Attend a MIS Club Meeting',
        description: 'Attend an MIS Club or AIS (Association for Information Systems) student chapter meeting. Submit proof of attendance (photo or sign-in sheet).',
        points: 30,
        due: '2024-12-15',
        location: 'Check MIS Club GroupMe for meeting times'
      },
      {
        id: 'A5',
        title: 'Visit the Ferguson Center',
        description: 'Take a team photo at the Ferguson Student Center. Bonus points if you\'re holding Bama gear or showing school spirit!',
        points: 10,
        due: '2024-12-10',
        location: 'Ferguson Center, University Blvd'
      },
      {
        id: 'A6',
        title: 'Connect with a Tech Company Recruiter',
        description: 'Attend a career fair or info session and speak with a recruiter from a tech company. Submit a business card or screenshot of LinkedIn connection.',
        points: 35,
        due: '2024-12-18',
        location: 'Career Center or company info sessions'
      },
      {
        id: 'A7',
        title: 'Create a Data Visualization',
        description: 'Using Tableau, Power BI, or Python, create a visualization about University of Alabama statistics (enrollment, football stats, etc.). Submit a screenshot.',
        points: 40,
        due: '2024-12-17',
        location: 'Complete independently'
      },
      {
        id: 'A8',
        title: 'Tour the Gorgas Library',
        description: 'Visit Gorgas Library and find the business/technology resources section. Take a photo of your team in the library.',
        points: 15,
        due: '2024-12-12',
        location: 'Gorgas Library, Capstone Dr'
      },
      {
        id: 'A9',
        title: 'Interview an MIS Alumni',
        description: 'Find and interview a UA MIS alumni (via LinkedIn, network, etc.). Ask about their career journey. Submit notes or recording summary.',
        points: 45,
        due: '2024-12-20',
        location: 'Virtual or in-person'
      },
      {
        id: 'A10',
        title: 'Bryant-Denny Stadium Scavenger',
        description: 'Take a team photo at Bryant-Denny Stadium. Show your Roll Tide pride! Bonus if you include something tech-related in the photo.',
        points: 15,
        due: '2024-12-11',
        location: 'Bryant-Denny Stadium'
      }
    ];

    const state = {
      role: 'student',
      currentUser: { team: null },
      teams: [
        { id: 'T1', name: 'Crimson Coders', members: 4, memberNames: ['Sarah Johnson', 'Mike Chen', 'Emily Davis', 'James Wilson'], score: 145 },
        { id: 'T2', name: 'Data Dynamos', members: 3, memberNames: ['Alex Rodriguez', 'Taylor Smith', 'Jordan Brown'], score: 180 },
        { id: 'T3', name: 'Analytics Avengers', members: 5, memberNames: ['Chris Lee', 'Morgan Taylor', 'Casey Martinez', 'Riley Anderson', 'Sam Parker'], score: 120 }
      ],
      faculty: [
        { id: 'F1', name: 'Dr. Randy Bradley', role: 'Department Chair & Professor', location: 'Alston Hall 340', bio: 'Expert in supply chain analytics and business intelligence. Published researcher in analytics and sustainability.' },
        { id: 'F2', name: 'Dr. Sarah Mitchell', role: 'MIS Academic Advisor', location: 'Culverhouse 225', bio: 'Specializes in student career development and internship placement. Former IT consultant at Deloitte.' },
        { id: 'F3', name: 'Prof. James Chen', role: 'MIS Lecturer', location: 'Alston Hall 210', bio: 'Teaches database management and systems analysis. 15 years of industry experience in enterprise systems.' },
        { id: 'F4', name: 'Dr. Emily Rodriguez', role: 'Associate Professor', location: 'Culverhouse 318', bio: 'Research focus on cybersecurity and data privacy. Regular speaker at security conferences.' }
      ],
      submissions: [],
      currentAssignment: null,
      currentReview: null,
      currentTeamDetail: null,
      currentFaculty: null,
      currentTaskEdit: null
    };

    // Initialize with some demo submissions
    state.submissions = [
      { id: 'S1', assignmentId: 'A2', teamId: 'T1', status: 'pending', comments: 'Met with advisor today!', fileName: 'advisor_meeting.jpg', submittedAt: new Date() },
      { id: 'S2', assignmentId: 'A1', teamId: 'T2', status: 'approved', comments: 'Great photo!', fileName: 'culverhouse.jpg', submittedAt: new Date() },
      { id: 'S3', assignmentId: 'A3', teamId: 'T1', status: 'rejected', comments: 'Found him in his office', fileName: 'bradley.jpg', rejectionReason: 'Photo is too blurry, please retake with better lighting', submittedAt: new Date() }
    ];

    // DOM Elements
    const loginSection = document.getElementById('loginSection');
    const portal = document.getElementById('portal');
    const studentTab = document.getElementById('studentTab');
    const taTab = document.getElementById('taTab');

    // Initialize
    document.querySelectorAll('[data-demo]').forEach(btn => {
      btn.addEventListener('click', () => showPortal(btn.dataset.demo));
    });
    document.getElementById('loginBtn').addEventListener('click', () => showPortal('student'));
    studentTab.addEventListener('click', () => switchRole('student'));
    taTab.addEventListener('click', () => switchRole('ta'));

    // Team Management
    document.getElementById('createTeamBtn').addEventListener('click', createTeam);
    document.getElementById('leaveTeamBtn').addEventListener('click', leaveTeam);

    // Modal handlers
    document.getElementById('submitAssignmentBtn').addEventListener('click', submitAssignment);
    document.getElementById('approveSubmissionBtn').addEventListener('click', () => reviewSubmission('approved'));
    document.getElementById('rejectSubmissionBtn').addEventListener('click', showRejectReason);
    document.getElementById('saveTeamBtn').addEventListener('click', saveTeamDetails);
    document.getElementById('deleteTeamBtn').addEventListener('click', deleteTeamFromModal);
    document.getElementById('saveFacultyBtn').addEventListener('click', saveFaculty);
    document.getElementById('deleteFacultyBtn').addEventListener('click', deleteFacultyFromModal);
    document.getElementById('createFacultyBtn').addEventListener('click', () => openFacultyModal());
    document.getElementById('createAssignmentBtn').addEventListener('click', () => openAssignmentEditModal());
    document.getElementById('saveAssignmentBtn').addEventListener('click', saveAssignment);
    document.getElementById('deleteAssignmentBtn').addEventListener('click', deleteAssignmentFromModal);

    function showPortal(role) {
      state.role = role;
      loginSection.classList.add('hidden');
      portal.classList.remove('hidden');
      // For student demo, don't auto-assign to team so they can see the team selection view
      if (role === 'student') {
        state.currentUser.team = null;
      }
      render();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function switchRole(role) {
      state.role = role;
      render();
    }

    function render() {
      const studentArea = document.getElementById('studentArea');
      const taArea = document.getElementById('taArea');

      if (state.role === 'student') {
        document.getElementById('activeRoleTitle').textContent = 'Student workspace';
        studentTab.setAttribute('aria-pressed', 'true');
        taTab.setAttribute('aria-pressed', 'false');
        studentArea.classList.remove('hidden');
        taArea.classList.add('hidden');
        renderStudentView();
      } else {
        document.getElementById('activeRoleTitle').textContent = 'TA administration';
        studentTab.setAttribute('aria-pressed', 'false');
        taTab.setAttribute('aria-pressed', 'true');
        studentArea.classList.add('hidden');
        taArea.classList.remove('hidden');
        renderTAView();
      }
    }

    function renderStudentView() {
      const hasTeam = state.currentUser.team !== null;
      const noTeamSection = document.getElementById('noTeamSection');
      const hasTeamSection = document.getElementById('hasTeamSection');
      const teamBadge = document.getElementById('studentTeamBadge');

      if (hasTeam) {
        const team = state.teams.find(t => t.id === state.currentUser.team);
        noTeamSection.classList.add('hidden');
        hasTeamSection.classList.remove('hidden');
        teamBadge.textContent = team.name;
        teamBadge.style.background = '#d1fae5';
        teamBadge.style.color = '#065f46';
        document.getElementById('currentTeamName').textContent = team.name;
        document.getElementById('currentTeamMembers').textContent = `${team.members} members ¬∑ ${team.score} points`;
      } else {
        noTeamSection.classList.remove('hidden');
        hasTeamSection.classList.add('hidden');
        teamBadge.textContent = 'No team';
        teamBadge.style.background = '#fee2e2';
        teamBadge.style.color = '#7f1d1d';
        renderAvailableTeams();
      }

      renderStudentLeaderboard();
      renderStudentFaculty();
      renderAssignmentLists();
    }

    function renderStudentLeaderboard() {
      const sorted = [...state.teams].sort((a, b) => b.score - a.score);
      const container = document.getElementById('studentLeaderboard');
      
      container.innerHTML = sorted.map((team, index) => {
        const rank = index + 1;
        const rankClass = rank === 1 ? 'first' : rank === 2 ? 'second' : rank === 3 ? 'third' : '';
        const maxScore = Math.max(...state.teams.map(t => t.score));
        const percentage = maxScore > 0 ? (team.score / maxScore) * 100 : 0;
        
        return `
          <div class="leaderboard-item">
            <div class="rank-badge ${rankClass}">${rank}</div>
            <div style="flex: 1;">
              <strong>${team.name}</strong>
              <div class="progress-bar" style="margin-top: 6px;">
                <div class="progress-fill" style="width: ${percentage}%"></div>
              </div>
              <span class="muted" style="font-size: 0.85rem;">${team.score} points ¬∑ ${team.members} members</span>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderStudentFaculty() {
      const container = document.getElementById('studentFacultyList');
      document.getElementById('facultyCount').textContent = state.faculty.length;
      
      container.innerHTML = state.faculty.map(faculty => `
        <div class="faculty-card">
          <div class="avatar">${faculty.name.charAt(0)}</div>
          <div>
            <strong>${faculty.name}</strong><br>
            <span class="muted">${faculty.role}</span><br>
            <span class="muted" style="font-size: 0.85rem;">üìç ${faculty.location}</span>
          </div>
          <button class="ghost" onclick="viewFacultyBio('${faculty.id}')">View bio</button>
        </div>
      `).join('');
    }

    function viewFacultyBio(facultyId) {
      const faculty = state.faculty.find(f => f.id === facultyId);
      if (!faculty) return;
      
      alert(`${faculty.name}\n${faculty.role}\n\n${faculty.bio}\n\nLocation: ${faculty.location}`);
    }

    function renderAvailableTeams() {
      const container = document.getElementById('availableTeamsList');
      container.innerHTML = state.teams.map(team => `
        <div class="team-card" onclick="joinTeam('${team.id}')">
          <div>
            <strong>${team.name}</strong><br>
            <span class="muted">${team.members} members ¬∑ ${team.score} points</span>
          </div>
          <button class="primary" onclick="event.stopPropagation(); joinTeam('${team.id}')">Join</button>
        </div>
      `).join('');
    }

    function renderAssignmentLists() {
      const userTeam = state.currentUser.team;
      const teamSubmissions = state.submissions.filter(s => s.teamId === userTeam);
      
      // Categorize assignments
      const todoAssignments = [];
      const pendingAssignments = [];
      const completeAssignments = [];

      ASSIGNMENTS.forEach(assignment => {
        const submission = teamSubmissions.find(s => s.assignmentId === assignment.id);
        
        if (!submission || submission.status === 'rejected') {
          todoAssignments.push({ ...assignment, submission });
        } else if (submission.status === 'pending') {
          pendingAssignments.push({ ...assignment, submission });
        } else if (submission.status === 'approved') {
          completeAssignments.push({ ...assignment, submission });
        }
      });

      // Render To-Do
      document.getElementById('todoCount').textContent = todoAssignments.length;
      document.getElementById('todoList').innerHTML = todoAssignments.map(a => `
        <div class="list-item">
          <div style="flex: 1;">
            <strong>${a.title}</strong>
            ${a.submission?.status === 'rejected' ? '<span class="status-pill rejected" style="margin-left: 10px;" onclick="showRejectionDetails(\'' + a.submission.id + '\')">Rejected ‚ö†Ô∏è</span>' : ''}
            <br>
            <span class="muted">${a.points} pts ¬∑ Due ${a.due}</span>
          </div>
          <button class="primary" onclick="openAssignmentModal('${a.id}')">View</button>
        </div>
      `).join('');

      // Render Pending
      document.getElementById('pendingCount').textContent = pendingAssignments.length;
      document.getElementById('pendingList').innerHTML = pendingAssignments.map(a => `
        <div class="list-item">
          <div style="flex: 1;">
            <strong>${a.title}</strong><br>
            <span class="muted">${a.points} pts ¬∑ Submitted ${a.submission.submittedAt.toLocaleDateString()}</span>
          </div>
          <span class="status-pill pending">Under review</span>
        </div>
      `).join('');

      // Render Complete
      document.getElementById('completeCount').textContent = completeAssignments.length;
      document.getElementById('completeList').innerHTML = completeAssignments.map(a => `
        <div class="list-item">
          <div style="flex: 1;">
            <strong>${a.title}</strong><br>
            <span class="muted">${a.points} pts ¬∑ Approved</span>
          </div>
          <span class="status-pill approved">‚úì Complete</span>
        </div>
      `).join('');
    }

    function createTeam() {
      const name = document.getElementById('newTeamName').value.trim();
      if (!name) return alert('Enter a team name');
      
      const newTeam = {
        id: 'T' + Date.now(),
        name,
        members: 1,
        memberNames: ['You'],
        score: 0
      };
      state.teams.push(newTeam);
      state.currentUser.team = newTeam.id;
      document.getElementById('newTeamName').value = '';
      render();
    }

    function joinTeam(teamId) {
      state.currentUser.team = teamId;
      const team = state.teams.find(t => t.id === teamId);
      team.members++;
      render();
    }

    function leaveTeam() {
      if (confirm('Are you sure you want to leave your team?')) {
        const team = state.teams.find(t => t.id === state.currentUser.team);
        if (team) team.members--;
        state.currentUser.team = null;
        render();
      }
    }

    function openAssignmentModal(assignmentId) {
      const assignment = ASSIGNMENTS.find(a => a.id === assignmentId);
      if (!assignment) return;

      state.currentAssignment = assignment;
      const modal = document.getElementById('assignmentModal');
      
      document.getElementById('modalTitle').textContent = assignment.title;
      document.getElementById('modalDescription').textContent = assignment.description;
      document.getElementById('modalPoints').textContent = `${assignment.points} points`;
      document.getElementById('modalDue').textContent = assignment.due;
      document.getElementById('modalLocation').textContent = assignment.location;

      // Check if there's a rejection
      const submission = state.submissions.find(s => 
        s.assignmentId === assignmentId && 
        s.teamId === state.currentUser.team &&
        s.status === 'rejected'
      );

      if (submission) {
        document.getElementById('rejectionSection').classList.remove('hidden');
        document.getElementById('rejectionReason').textContent = submission.rejectionReason;
      } else {
        document.getElementById('rejectionSection').classList.add('hidden');
      }

      // Clear form
      document.getElementById('uploadFile').value = '';
      document.getElementById('submissionComments').value = '';

      modal.classList.remove('hidden');
    }

    function closeAssignmentModal() {
      document.getElementById('assignmentModal').classList.add('hidden');
    }

    function submitAssignment() {
      const fileInput = document.getElementById('uploadFile');
      const comments = document.getElementById('submissionComments').value.trim();
      
      if (!fileInput.files[0]) {
        return alert('Please upload a file');
      }

      const fileName = fileInput.files[0].name;
      const assignment = state.currentAssignment;

      // Remove any existing submissions for this assignment
      state.submissions = state.submissions.filter(s => 
        !(s.assignmentId === assignment.id && s.teamId === state.currentUser.team)
      );

      // Add new submission
      state.submissions.push({
        id: 'S' + Date.now(),
        assignmentId: assignment.id,
        teamId: state.currentUser.team,
        status: 'pending',
        comments: comments || 'No comments',
        fileName,
        submittedAt: new Date()
      });

      closeAssignmentModal();
      render();
      alert('Submission uploaded! Waiting for TA review.');
    }

    function showRejectionDetails(submissionId) {
      const submission = state.submissions.find(s => s.id === submissionId);
      if (!submission) return;

      document.getElementById('rejectionModalReason').textContent = submission.rejectionReason;
      document.getElementById('rejectionModal').classList.remove('hidden');
    }

    function closeRejectionModal() {
      document.getElementById('rejectionModal').classList.add('hidden');
    }

    function renderTAView() {
      // Render teams
      const teamList = document.getElementById('taTeamList');
      teamList.innerHTML = state.teams.map(team => `
        <div class="list-item">
          <div style="flex: 1;">
            <strong>${team.name}</strong><br>
            <span class="muted">${team.members} members ¬∑ ${team.score} points</span>
          </div>
          <button class="ghost" onclick="openTeamDetailModal('${team.id}')">View</button>
        </div>
      `).join('');
      document.getElementById('teamTotal').textContent = `${state.teams.length} teams`;

      // Render TA leaderboard
      const sorted = [...state.teams].sort((a, b) => b.score - a.score);
      const leaderboardContainer = document.getElementById('taLeaderboard');
      
      leaderboardContainer.innerHTML = sorted.map((team, index) => {
        const rank = index + 1;
        const rankClass = rank === 1 ? 'first' : rank === 2 ? 'second' : rank === 3 ? 'third' : '';
        const maxScore = Math.max(...state.teams.map(t => t.score));
        const percentage = maxScore > 0 ? (team.score / maxScore) * 100 : 0;
        
        return `
          <div class="leaderboard-item">
            <div class="rank-badge ${rankClass}">${rank}</div>
            <div style="flex: 1;">
              <strong>${team.name}</strong>
              <div class="progress-bar" style="margin-top: 6px;">
                <div class="progress-fill" style="width: ${percentage}%"></div>
              </div>
              <span class="muted" style="font-size: 0.85rem;">${team.score} points ¬∑ ${team.members} members</span>
            </div>
          </div>
        `;
      }).join('');

      // Render assignments
      const assignmentList = document.getElementById('taAssignmentList');
      document.getElementById('assignmentCount').textContent = ASSIGNMENTS.length;
      assignmentList.innerHTML = ASSIGNMENTS.map(assignment => `
        <div class="list-item">
          <div style="flex: 1;">
            <strong>${assignment.title}</strong><br>
            <span class="muted">${assignment.points} pts ¬∑ Due ${assignment.due}</span>
          </div>
          <button class="ghost" onclick="openAssignmentEditModal('${assignment.id}')">Edit</button>
        </div>
      `).join('');

      // Render faculty
      const facultyList = document.getElementById('taFacultyList');
      document.getElementById('taFacultyCount').textContent = state.faculty.length;
      facultyList.innerHTML = state.faculty.map(faculty => `
        <div class="faculty-card">
          <div class="avatar">${faculty.name.charAt(0)}</div>
          <div style="flex: 1;">
            <strong>${faculty.name}</strong><br>
            <span class="muted">${faculty.role}</span><br>
            <span class="muted" style="font-size: 0.85rem;">üìç ${faculty.location}</span>
          </div>
          <button class="ghost" onclick="openFacultyModal('${faculty.id}')">Edit</button>
        </div>
      `).join('');

      // Render review queue
      const pendingSubmissions = state.submissions.filter(s => s.status === 'pending');
      const reviewList = document.getElementById('reviewList');
      reviewList.innerHTML = pendingSubmissions.map(sub => {
        const assignment = ASSIGNMENTS.find(a => a.id === sub.assignmentId);
        const team = state.teams.find(t => t.id === sub.teamId);
        return `
          <div class="list-item">
            <div style="flex: 1;">
              <strong>${assignment.title}</strong><br>
              <span class="muted">Team: ${team.name} ¬∑ ${assignment.points} pts</span>
            </div>
            <button class="ghost" onclick="openReviewModal('${sub.id}')">Review</button>
          </div>
        `;
      }).join('');
      document.getElementById('reviewTotal').textContent = `${pendingSubmissions.length} pending`;
    }

    function addTeamAsTA() {
      const name = document.getElementById('taTeamName').value.trim();
      if (!name) return alert('Enter a team name');
      
      state.teams.push({
        id: 'T' + Date.now(),
        name,
        members: 0,
        memberNames: [],
        score: 0
      });
      document.getElementById('taTeamName').value = '';
      render();
    }

    function deleteTeam(teamId) {
      if (confirm('Delete this team?')) {
        state.teams = state.teams.filter(t => t.id !== teamId);
        render();
      }
    }

    function openTeamDetailModal(teamId) {
      const team = state.teams.find(t => t.id === teamId);
      if (!team) return;

      state.currentTeamDetail = team;
      document.getElementById('editTeamName').value = team.name;
      document.getElementById('teamScore').textContent = `${team.score} points`;
      
      const membersList = document.getElementById('teamMembersList');
      membersList.innerHTML = team.memberNames && team.memberNames.length > 0
        ? team.memberNames.map(name => `
            <div style="padding: 8px; background: #f8fafc; border-radius: 8px; margin-bottom: 6px;">
              ${name}
            </div>
          `).join('')
        : '<span class="muted">No members yet</span>';

      document.getElementById('teamDetailModal').classList.remove('hidden');
    }

    function closeTeamDetailModal() {
      document.getElementById('teamDetailModal').classList.add('hidden');
      state.currentTeamDetail = null;
    }

    function saveTeamDetails() {
      const team = state.currentTeamDetail;
      if (!team) return;

      const newName = document.getElementById('editTeamName').value.trim();
      if (!newName) return alert('Team name cannot be empty');

      team.name = newName;
      closeTeamDetailModal();
      render();
    }

    function deleteTeamFromModal() {
      const team = state.currentTeamDetail;
      if (!team) return;

      if (confirm(`Are you sure you want to delete ${team.name}? This cannot be undone.`)) {
        state.teams = state.teams.filter(t => t.id !== team.id);
        closeTeamDetailModal();
        render();
      }
    }

    // Faculty management
    function openFacultyModal(facultyId = null) {
      if (facultyId) {
        const faculty = state.faculty.find(f => f.id === facultyId);
        if (!faculty) return;
        
        state.currentFaculty = faculty;
        document.getElementById('facultyModalTitle').textContent = 'Edit Faculty/Staff Bio';
        document.getElementById('facultyName').value = faculty.name;
        document.getElementById('facultyRole').value = faculty.role;
        document.getElementById('facultyLocation').value = faculty.location;
        document.getElementById('facultyBio').value = faculty.bio;
        document.getElementById('deleteFacultyBtn').classList.remove('hidden');
      } else {
        state.currentFaculty = null;
        document.getElementById('facultyModalTitle').textContent = 'Add Faculty/Staff Bio';
        document.getElementById('facultyName').value = '';
        document.getElementById('facultyRole').value = '';
        document.getElementById('facultyLocation').value = '';
        document.getElementById('facultyBio').value = '';
        document.getElementById('deleteFacultyBtn').classList.add('hidden');
      }
      
      document.getElementById('facultyModal').classList.remove('hidden');
    }

    function closeFacultyModal() {
      document.getElementById('facultyModal').classList.add('hidden');
      state.currentFaculty = null;
    }

    function saveFaculty() {
      const name = document.getElementById('facultyName').value.trim();
      const role = document.getElementById('facultyRole').value.trim();
      const location = document.getElementById('facultyLocation').value.trim();
      const bio = document.getElementById('facultyBio').value.trim();

      if (!name) return alert('Please enter a name');

      if (state.currentFaculty) {
        // Edit existing
        state.currentFaculty.name = name;
        state.currentFaculty.role = role;
        state.currentFaculty.location = location;
        state.currentFaculty.bio = bio;
      } else {
        // Create new
        state.faculty.push({
          id: 'F' + Date.now(),
          name,
          role,
          location,
          bio
        });
      }

      closeFacultyModal();
      render();
    }

    function deleteFacultyFromModal() {
      if (!state.currentFaculty) return;
      
      if (confirm(`Delete ${state.currentFaculty.name}?`)) {
        state.faculty = state.faculty.filter(f => f.id !== state.currentFaculty.id);
        closeFacultyModal();
        render();
      }
    }

    // Assignment management
    function openAssignmentEditModal(assignmentId = null) {
      if (assignmentId) {
        const assignment = ASSIGNMENTS.find(a => a.id === assignmentId);
        if (!assignment) return;
        
        state.currentTaskEdit = assignment;
        document.getElementById('assignmentEditModalTitle').textContent = 'Edit Assignment';
        document.getElementById('assignmentTitle').value = assignment.title;
        document.getElementById('assignmentDescription').value = assignment.description;
        document.getElementById('assignmentPoints').value = assignment.points;
        document.getElementById('assignmentDue').value = assignment.due;
        document.getElementById('assignmentLocation').value = assignment.location;
        document.getElementById('deleteAssignmentBtn').classList.remove('hidden');
      } else {
        state.currentTaskEdit = null;
        document.getElementById('assignmentEditModalTitle').textContent = 'Create Assignment';
        document.getElementById('assignmentTitle').value = '';
        document.getElementById('assignmentDescription').value = '';
        document.getElementById('assignmentPoints').value = '';
        document.getElementById('assignmentDue').value = '';
        document.getElementById('assignmentLocation').value = '';
        document.getElementById('deleteAssignmentBtn').classList.add('hidden');
      }
      
      document.getElementById('assignmentEditModal').classList.remove('hidden');
    }

    function closeAssignmentEditModal() {
      document.getElementById('assignmentEditModal').classList.add('hidden');
      state.currentTaskEdit = null;
    }

    function saveAssignment() {
      const title = document.getElementById('assignmentTitle').value.trim();
      const description = document.getElementById('assignmentDescription').value.trim();
      const points = parseInt(document.getElementById('assignmentPoints').value) || 0;
      const due = document.getElementById('assignmentDue').value;
      const location = document.getElementById('assignmentLocation').value.trim();

      if (!title) return alert('Please enter a title');
      if (!description) return alert('Please enter a description');

      if (state.currentTaskEdit) {
        // Edit existing
        state.currentTaskEdit.title = title;
        state.currentTaskEdit.description = description;
        state.currentTaskEdit.points = points;
        state.currentTaskEdit.due = due;
        state.currentTaskEdit.location = location;
      } else {
        // Create new
        ASSIGNMENTS.push({
          id: 'A' + Date.now(),
          title,
          description,
          points,
          due,
          location
        });
      }

      closeAssignmentEditModal();
      render();
    }

    function deleteAssignmentFromModal() {
      if (!state.currentTaskEdit) return;
      
      if (confirm(`Delete "${state.currentTaskEdit.title}"?`)) {
        const index = ASSIGNMENTS.findIndex(a => a.id === state.currentTaskEdit.id);
        if (index > -1) {
          ASSIGNMENTS.splice(index, 1);
        }
        closeAssignmentEditModal();
        render();
      }
    }

    function openReviewModal(submissionId) {
      const submission = state.submissions.find(s => s.id === submissionId);
      if (!submission) return;

      state.currentReview = submission;
      const assignment = ASSIGNMENTS.find(a => a.id === submission.assignmentId);
      const team = state.teams.find(t => t.id === submission.teamId);

      document.getElementById('reviewTeamName').textContent = team.name;
      document.getElementById('reviewAssignmentTitle').textContent = assignment.title;
      document.getElementById('reviewComments').textContent = submission.comments;
      document.getElementById('reviewFile').textContent = submission.fileName;
      document.getElementById('rejectReasonSection').classList.add('hidden');
      document.getElementById('rejectReasonInput').value = '';

      document.getElementById('reviewModal').classList.remove('hidden');
    }

    function closeReviewModal() {
      document.getElementById('reviewModal').classList.add('hidden');
    }

    function showRejectReason() {
      const section = document.getElementById('rejectReasonSection');
      if (section.classList.contains('hidden')) {
        section.classList.remove('hidden');
      } else {
        const reason = document.getElementById('rejectReasonInput').value.trim();
        if (!reason) return alert('Please provide a rejection reason');
        reviewSubmission('rejected', reason);
      }
    }

    function reviewSubmission(status, rejectionReason = '') {
      const submission = state.currentReview;
      if (!submission) return;

      submission.status = status;
      if (status === 'rejected') {
        submission.rejectionReason = rejectionReason;
      } else if (status === 'approved') {
        // Add points to team
        const team = state.teams.find(t => t.id === submission.teamId);
        const assignment = ASSIGNMENTS.find(a => a.id === submission.assignmentId);
        if (team && assignment) {
          team.score += assignment.points;
        }
      }

      closeReviewModal();
      render();
    }

    // Initial render
    render();
  </script>
</body>
</html>